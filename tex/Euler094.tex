\documentclass[a4paper,12pt]{article}
\usepackage{amssymb}
\usepackage{amsmath}
\newcommand*{\QED}{\hfill\ensuremath{\blacksquare}}
\begin{document}
\setlength\parindent{0pt}
\textbf{Project Euler 94}
\vspace{5ex}


\section*{First case}

Let \(n, n, n + 1\) be sides length.
From Heron's formula we can compute area of this triangle:

\[A = \sqrt{\frac{3n + 1}{2} \frac{n + 1}{2}
\frac{n + 1}{2} \frac{n - 1}{2}} = \frac{n + 1}{4} \sqrt{3n^2 - 2n - 1}\]

One can check that if \(n\) is even, \(A\) is not integer.
Therefore let \(n = 2k - 1\). We have
\(A = k \sqrt{3k^2 - 4k + 1}\). When is \((3k - 1)(k - 1)\) a square?

There exist unique integers \(u\) and \(p\) such that \(k - 1 = 2^up\) and
\(p\) is odd. There are two cases:
\begin{itemize}
\item \(u > 0\)

\(3k - 1 = 3 \cdot 2^up + 2 = 2(2^{u - 1} \cdot 3p + 1)\).
Since \((3k - 1)(k - 1)\) must have even amount of 2s in factorization,
\(u\) is odd. Let \(u = 2z + 1\). We have \((k - 1)(3k - 1) =
2(4^z \cdot 3p + 1) \cdot 4^z \cdot 2p = 4^{z + 1} p(4^z \cdot 3p + 1)\).

Since \(\gcd(p, 4^z \cdot 3p + 1) = \gcd(p, 1) = 1\),
\(p\) must be a perfect square. Let \(p = m^2\), where \(m\) is odd.
When is \(4^z \cdot 3p + 1 = 4^z \cdot 3m^2 + 1\) a perfect square?

We want to find solutions to equation \(4^z \cdot 3m^2 + 1 = x^2\).
Let \(y = 2^zm\). Then we can transform it into Pell's equation
\(x^2 - 3y^2 = 1\). Fundamental solution is \(x_1 = 2, y_1 = 1\)
and another solutions are generated from recursive formulas:
\(x_{k + 1} = x_1x_k + 3y_1y_k\) and \(y_{k + 1} = x_1y_k + y_1x_k\).

Given \(x\) and \(y\), we should revert this to find \(n\).
We have \(y = 2^zm\), so \(4y^2 + 1 = 2(2y^2 + 1) - 1 =
2(2^{2z + 1}m^2 + 1) - 1 = 2(2^up + 1) - 1 = 2k - 1 = n\).

\item \(u = 0\)

When is \((3k - 1)(k - 1) = p(3p + 2)\) a perfect square?
Since \(p\) is odd, we have \(\gcd(p, 3p + 2) = \gcd(p, 2) = 1\),
so both \(p\) and \(3p + 2\) must be a perfect square.
However, all squares are equal to 0 or 1 modulo 3, so no solutions exist.

\end{itemize}

\section*{Second case}

Let \(n, n, n - 1\) be sides length.
From Heron's formula we can compute area of this triangle:

\[A = \sqrt{\frac{3n - 1}{2} \frac{n - 1}{2}
\frac{n - 1}{2} \frac{n + 1}{2}} = \frac{n - 1}{4} \sqrt{3n^2 + 2n - 1}\]

One can check that if \(n\) is even, \(A\) is not integer.
Therefore let \(n = 2k + 1\). We have
\(A = k \sqrt{3k^2 + 4k + 1}\). When is \((3k + 1)(k + 1)\) a square?

There exist unique integers \(u\) and \(p\) such that \(k + 1 = 2^up\) and
\(p\) is odd. There are two cases:
\begin{itemize}
\item \(u > 0\)

\(3k + 1 = 3 \cdot 2^up - 2 = 2(2^{u - 1} \cdot 3p - 1)\).
Since \((3k + 1)(k + 1)\) must have even amount of 2s in factorization,
\(u\) is odd. Let \(u = 2z + 1\). We have \((k + 1)(3k + 1) =
2(4^z \cdot 3p - 1) \cdot 4^z \cdot 2p = 4^{z + 1} p(4^z \cdot 3p - 1)\).

Since \(\gcd(p, 4^z \cdot 3p - 1) = \gcd(p, p - 1) = 1\),
\(p\) must be a perfect square. Let \(p = m^2\), where \(m\) is odd.
When is \(4^z \cdot 3p - 1 = 4^z \cdot 3m^2 - 1\) a perfect square?

We want to find solutions to equation \(4^z \cdot 3m^2 - 1 = x^2\).
Let \(y = 2^zm\). Then we can transform it into negative Pell equation
\(x^2 - 3y^2 = -1\). This equation does not have any integer solutions.

\item \(u = 0\)

When is \((k + 1)(3k + 1) = p(3p - 2)\) a perfect square? Since \(p\) is odd,
we have \(\gcd(p, 3p - 2) = \gcd(p, p - 2) = \gcd(2, p - 2) = 1\).
Therefore \(p = m^2\) must be a perfect square, so must be \(3p - 2\).

We want to find solutions to equation \(3m^2 - 2 = r^2\):
\[3m^2 - r^2 = 2\]
\[(3m^2 - r^2)^2 = 4\]
\[(3m^2 + r^2)^2 - 4 \cdot 3 (mr)^2 = 4\]
\[(2 + 2r^2)^2 - 4 \cdot 3(mr)^2 = 4\]
\[4(r^2 + 1)^2 - 4 \cdot 3(mr)^2 = 4\]

Substituting \(r^2 + 1 = x\) and \(mr = y\), we get
Pell equation \(x^2 - 3y^2 = 1\). 

Given \(x\) and \(y\), we should revert this to find \(n\).
We have \(x = r^2 + 1 = 3m^2 - 1 = 3p - 1\), so
\(2 (x + 1) / 3 - 1 = 2p - 1 = 2k + 1 = n\).

\textit{Implementation details:} Pell solution \(x_k\)
satisfies property \(x_k = r^2 + 1\) only when \(k\) is odd.

We can prove stronger facts:

\textit{Theorem 1:} If \(n\) is even, there exists an integer \(p_n\) such that
\(x_n = 6p_n^2 + 1\). Therefore, \(x_n - 1\) can't be a perfect square.

\textit{Proof by induction:} For \(n = 2\) we have \(x_2 = 7 = 6 \cdot 1^2 + 1\).

Suppose that \(l\) is even and \(x_l = 6p_l^2 + 1\). Then
\(y_l = \sqrt{\dfrac{x_l^2 - 1}{3}} = 2p_l\sqrt{3p_l^2 + 1}\).
Since \(y_l\) is integer, \(\sqrt{3p_l^2 + 1}\) is rational, so it is integer.

Now \(x_{l + 2} = 2x_{l + 1} + 3y_{l + 1} = 2(2x_l + 3y_l) + 3(2y_l + x_l) =
7x_l + 12y_l = 7(6p_l^2 + 1) + 24p_l\sqrt{3p_l^2 + 1} =
6(7p_l^2 + 4p_l\sqrt{3p_l^2 + 1} + 1) + 1 =
6(2p_l + \sqrt{3p_l^2 + 1})^2 + 1\). \QED

\textit{Theorem 2:} If \(n\) is odd, there exists an integer \(p_n\) such that
\(x_n = (3p_n \pm 1)^2 + 1\).

\textit{Proof by induction:} For \(n = 1\) we have
\(x_1 = 2 = (3 \cdot 0 + 1)^2 + 1\).

Suppose that \(l\) is odd and \(x_l = (3p_l \pm 1)^2 + 1\). Then
\(y_l = \sqrt{\dfrac{x_l^2 - 1}{3}} =
\sqrt{\dfrac{(3p_l \pm 1)^2((3p_l \pm 1)^2 + 2)}{3}} =
(3p_l \pm 1) \sqrt{3p_l^2 \pm 2p_l + 1}\). Since \(y_l\) is integer,
\(\sqrt{3p_l^2 \pm 2p_l + 1}\) is rational, so it is integer.

Now \(x_{l + 2} = 2x_{l + 1} + 3y_{l + 1} = 2(2x_l + 3y_l) + 3(2y_l + x_l) =
7x_l + 12y_l = 7(9p_l^2 \pm 6p_l + 2) + 12(3p_l \pm 1)\sqrt{3p_l^2 \pm 2p_l + 1} =
(3\sqrt{3p_l^2 \pm 2p_l + 1} + 2(3p_l \pm 1))^2 =
(3(\sqrt{3p_l^2 \pm 2p_l + 1} + 2p_l) \pm 2)^2\). \QED

Note, that from this proof it easily follows that if \(n = 4k + 1\), then
\(x_n = (3p_n + 1)^2 + 1\) and if \(n = 4k + 3\), then
\(x_n = (3p_n - 1)^2 + 1\).

\end{itemize}

\end{document}